<div class="bg-body-profile">
  <div class="container container-profile">
    <div class='d-flex align-items-center'>
      <div> <%= cl_image_tag current_user.photo.key, class: 'avatar-profile mx-3'%> </div>
      <div class='text-white'><h1> Bienvenue sur City Pulse <%= current_user.nickname %> ! </h1></div>
    </div>


    <div class="user-infos">
      <div class="bio">
      <h3 class='text-white my-5'> La bio de l'utilisateur sera ici ! </h3>
      </div>

      <div class="pulses-top">
        <h3 class='text-white'> Tes meilleurs Pulses :</h3>
        <% unless current_user.pulses.nil? %>
          <% if current_user.pulses.length == 1 %>
            <% limit = 1 %>
          <% elsif current_user.pulses.length == 2 %>
            <% limit = 2 %>
          <% else %>
            <% limit = 3 %>
          <% end %>
          <% top2 = current_user.pulses.limit(limit).sort_by { |pulse| pulse.favorites.count.nil? ? pulse.favorites.count : pulse.favorites.count } %>
          <%# # triÃ© par fake_votes et non vrais favoris. changer par pulse.favorites.count au besoin %>
          <% top2.reverse.each do |top| %>
            <div class="pulses-profile d-flex">
                <div class='icone-profile'>
                  <% top.categories.each do |category| %>
                    <div class='best-icone'><%= sanitize category.picto %></div>
                  <% end %>
                </div>
                <div class="pulse-profile-description">
                  <p><%= top.pulse_content %> : <strong><%= top.favorites.length + (top.favorites.count.nil? ? 0 : top.favorites.count) %> ğŸ’™ </strong> </p>
                </div>
            </div>
          <% end %>
        <% end %>
      </div>

    </div>
  </div>

  <div class="d-grid">
    <%= link_to "Log out", destroy_user_session_path, method: :delete %>
    <%= link_to 'Modifier mon profil', edit_user_path(current_user)%>
  </div>
</div>
